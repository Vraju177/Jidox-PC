{% extends "partials/base.html" %}
{% load static %}

{% block title %}New User Creation{% endblock title %}

{% block pagetitle %}
{% include "partials/page-title.html" with pagetitle="Forms" title="New User Creation" %}
{% endblock pagetitle %}

{% block content %}
<div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-body">
                <form id="user-form" class="needs-validation" novalidate>
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label" for="validationCustom01">Full name</label>
                        <input type="text" class="form-control" id="validationCustom01" placeholder="Full name" required>
                        <div class="valid-feedback">Looks good!</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="validationCustomUsername">Username</label>
                        <div class="input-group">
                            <span class="input-group-text" id="inputGroupPrepend">@</span>
                            <input type="text" class="form-control" id="validationCustomUsername" placeholder="Username" required>
                            <div class="invalid-feedback">Please choose a username.</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="validationCustom03">Node</label>
                        <input type="text" class="form-control" id="validationCustom03" placeholder="Node" required>
                        <div class="invalid-feedback">Please provide a Node.</div>
                    </div>
            </div> <!-- end card-body-->
        </div> <!-- end card-->
    </div> <!-- end col-->

    <div class="col-lg-6">
        <div class="card">
            <div class="card-body">
                <div class="position-relative mb-3">
                    <label class="form-label" for="validationTooltip05">Service Type</label>
                    <input type="text" class="form-control" id="validationTooltip05" placeholder="Service Type" required>
                    <div class="invalid-tooltip">Please provide a valid Service Type.</div>
                </div>
                <div class="position-relative mb-3">
                    <label class="form-label" for="validationTooltip06">Creation Date</label>
                    <input type="date" class="form-control" id="validationTooltip06" placeholder="User Creation Date" required>
                    <div class="invalid-tooltip">Please provide a valid Date.</div>
                </div>
                <div class="position-relative mb-3">
                    <label class="form-label" for="validationTooltip01">Status</label>
                    <input type="text" class="form-control" id="validationTooltip01" placeholder="Status" required>
                    <div class="valid-tooltip">Looks good!</div>
                    <div class="invalid-tooltip">Please enter Status.</div>
                </div>
                <button class="btn btn-primary" type="submit">Submit form</button>
            </div> <!-- end card-body-->
        </div> <!-- end card-->
    </div> <!-- end col-->
</div>
<!-- end row -->
{% endblock content %}

{% block extra_js %}
    <script>
        // Get CSRF token from the document cookie
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        document.querySelector('form.needs-validation').addEventListener('submit', function (event) {
            event.preventDefault();

            // Format the date correctly (you can customize this as needed)
            let dateInput = document.getElementById('validationTooltip06').value;
            let formattedDate = new Date(dateInput).toISOString().split('T')[0]; // This ensures 'YYYY-MM-DD' format

            let formData = new FormData();
            formData.append('full_name', document.getElementById('validationCustom01').value);
            formData.append('username', document.getElementById('validationCustomUsername').value);
            formData.append('node', document.getElementById('validationCustom03').value);
            formData.append('service_type', document.getElementById('validationTooltip05').value);
            formData.append('user_creation_date', formattedDate);  // Use the formatted date
            formData.append('status', document.getElementById('validationTooltip01').value);

            // Include CSRF token in the request headers
            fetch("{% url 'users:create_user' %}", {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrftoken,  // Adding CSRF token
                },
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message); // Show message or redirect on success
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>

    <!-- App js -->
    <script src="{% static 'js/app.min.js' %}"></script>

{% endblock extra_js %}
